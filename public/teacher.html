<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readitude Teacher</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="teacher-container">
        <!-- ★ 상단 메뉴 그룹 (헤더 + 탭) -->
        <div class="sticky-header-group">
            <!-- 헤더 -->
            <header class="teacher-header">
                <div class="logo-area">
                    <img src="logo.png" alt="Readitude Logo" class="header-logo" onerror="this.style.display='none'; document.getElementById('fallback-icon').style.display='inline-block'">
                    <i id="fallback-icon" class="fa-solid fa-chalkboard-user" style="display:none; font-size: 1.5rem; color: #32bfb6;"></i>
                    <h2>Readitude Teacher</h2>
                </div>
                <button class="btn-secondary logout-btn" onclick="logout()">로그아웃</button>
            </header>

            <!-- 탭 메뉴 -->
            <nav class="teacher-nav">
                <button class="nav-btn active" onclick="switchTab('tab-1', this)">👥 학생 관리</button>
                <button class="nav-btn" onclick="switchTab('tab-2', this)">📊 학습 현황</button>
                <button class="nav-btn" onclick="switchTab('tab-3', this)">🛠️ 단어 업로드</button>
                <button class="nav-btn" onclick="switchTab('tab-4', this)">🖨️ 인쇄 센터</button>
            </nav>
        </div>

        <!-- 1. 학생 관리 -->
        <div id="tab-1" class="tab-content active">
            <div class="section-title">
                <h3>학생 관리 및 교재 배정</h3>
                <p>노션(Notion)의 학생 데이터를 불러옵니다. 교재를 선택하고 [저장]을 누르세요.</p>
            </div>
            
            <div class="table-container">
                <table class="planner-table">
                    <thead>
                        <tr>
                            <th width="10%">이름</th>
                            <th width="10%">아이디</th>
                            <th>교재 1</th>
                            <th>교재 2</th>
                            <th>교재 3</th>
                            <th width="10%">관리</th>
                        </tr>
                    </thead>
                    <tbody id="student-list-body">
                        <!-- JS로 데이터 로드 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 2. 학습 현황 -->
        <div id="tab-2" class="tab-content">
            <div class="section-title">
                <h3>실시간 학습 현황</h3>
                <div class="filter-wrapper">
                    <div class="filter-group">
                        <button class="filter-btn active" onclick="setPeriod('today', this)">오늘</button>
                        <button class="filter-btn" onclick="setPeriod('week', this)">1주일</button>
                        <button class="filter-btn" onclick="setPeriod('2weeks', this)">2주일</button>
                        <button class="filter-btn" onclick="setPeriod('month', this)">1개월</button>
                    </div>
                    <div class="date-range">
                        <button class="refresh-btn" onclick="loadDashboard()" title="현황 새로고침">
                            <i class="fa-solid fa-rotate-right"></i>
                        </button>
                        <input type="date" id="dash-date-start" class="date-picker"> 
                        <span>~</span> 
                        <input type="date" id="dash-date-end" class="date-picker">
                        <button class="btn-primary search-btn" onclick="loadDashboard()">조회</button>
                    </div>
                </div>
            </div>

            <!-- 학습 현황 표 -->
            <div class="table-container">
                <table class="planner-table">
                    <thead>
                        <tr>
                            <th width="12%">학생 이름</th>
                            <th width="20%">학습 교재 / 유닛</th>
                            <th width="15%">최근 학습일</th>
                            <th>학습 진행도 & 점수</th>
                            <th width="10%">시험 승인</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-body">
                        <!-- JS로 데이터 로드 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 3. 단어 데이터 업로드 -->
        <div id="tab-3" class="tab-content">
            <div class="section-title">
                <h3>단어 데이터 관리소</h3>
                <p>새로운 교재 데이터를 업로드합니다.</p>
            </div>

            <div class="upload-card">
                <div class="card-header">
                    <h4>📝 간편 텍스트 업로드</h4>
                    <span class="tip">엑셀 복사(Ctrl+C) → 붙여넣기(Ctrl+V)</span>
                </div>
                <div class="card-body">
                    <div class="upload-guide">
                        순서: <code>영어</code> | <code>뜻</code> | <code>반의어</code> | <code>유의어</code> | <code>예문</code>
                    </div>
                    <div class="input-row">
                        <input type="text" id="manual-book-name" placeholder="교재명 (예: 능률보카)">
                        <input type="text" id="manual-unit-name" placeholder="유닛명 (예: Day 01)">
                    </div>
                    <textarea id="manual-text-input" class="bulk-text-area" placeholder="내용을 붙여넣으세요..."></textarea>
                    <button class="btn-primary full-width" onclick="uploadManualText()">업로드 및 저장</button>
                </div>
            </div>
            
            <div class="upload-card mt-20">
                <div class="card-header">
                    <h4>📂 CSV 파일 업로드</h4>
                    <button class="btn-text" onclick="downloadTemplate()">양식 다운로드</button>
                </div>
                <div class="card-body flex-row">
                    <input type="file" id="csv-file" accept=".csv">
                    <button class="btn-primary" onclick="uploadCSV()">파일 업로드</button>
                </div>
            </div>

            <!-- 교재 삭제 기능 -->
            <div class="upload-card mt-20" style="border-color: #ffcdd2; background-color: #ffebee;">
                <div class="card-header" style="background-color: #ef9a9a; color: white;">
                    <h4>🗑️ 교재 데이터 삭제</h4>
                    <span style="font-size:0.8rem;">주의: 선택한 교재의 모든 단어가 삭제됩니다!</span>
                </div>
                <div class="card-body flex-row">
                    <select id="delete-book-select" style="flex:1; padding:10px;"><option>삭제할 교재 선택</option></select>
                    <button class="btn-primary" style="background-color: #d32f2f; width: auto; box-shadow: 0 4px 0 #b71c1c;" onclick="deleteBook()">삭제하기</button>
                </div>
            </div>
        </div>

        <!-- 4. 인쇄 센터 -->
        <div id="tab-4" class="tab-content">
            <div class="section-title">
                <h3>스마트 인쇄 센터</h3>
                <p>맞춤형 시험지와 워크북을 제작합니다.</p>
            </div>
            
            <div class="print-panel">
                <div class="panel-section">
                    <label>1. 교재 및 범위</label>
                    <div class="row">
                        <select id="print-book-select" onchange="loadPrintUnits()"><option>교재 선택</option></select>
                        <select id="print-unit-select"><option>유닛 선택</option></select>
                    </div>
                </div>
                <div class="panel-section">
                    <label>2. 문제 수</label>
                    <input type="number" id="print-total-count" value="20" min="5">
                </div>
                <div class="panel-section full">
                    <label>3. 출제 비율 (%)</label>
                    <div class="ratio-inputs">
                        <div><span>의미</span><input type="number" id="ratio-meaning" value="40">%</div>
                        <div><span>스펠링</span><input type="number" id="ratio-spelling" value="30">%</div>
                        <div><span>예문</span><input type="number" id="ratio-example" value="20">%</div>
                        <div><span>유/반</span><input type="number" id="ratio-synant" value="10">%</div>
                    </div>
                </div>
                <div class="panel-actions">
                    <button class="btn-primary" onclick="generatePrint('test')">📄 시험지</button>
                    <button class="btn-game" onclick="generatePrint('workbook')">📘 워크북</button>
                    <button class="btn-secondary" onclick="generatePrint('answer')">✅ 답안지</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 인쇄 영역 (숨김) -->
    <div id="print-area" class="print-area">
        <div class="print-header">
            <h1 id="print-title">Vocabulary Test</h1>
            <div class="print-info">
                <span>Class: __________</span> <span>Name: ______________</span> <span>Score: ______</span>
            </div>
        </div>
        <table class="print-table"><tbody id="print-tbody"></tbody></table>
    </div>

    <script src="teacher.js"></script>
</body>
</html>