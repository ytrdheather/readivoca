<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readitude Voca</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- 효과음 오디오 (정답 소리) -->
    <audio id="sfx-correct" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

    <div class="container">
        <!-- 1. 로그인 -->
        <div id="login-section">
            <h2 style="color:#32bfb6"><i class="fa-solid fa-graduation-cap"></i> Readitude</h2>
            <input type="text" id="username" placeholder="아이디">
            <input type="password" id="password" placeholder="비밀번호">
            <button class="btn-primary" onclick="login()">로그인</button>
        </div>

        <!-- 2. 교재 선택 -->
        <div id="selection-section" class="hidden">
            <h2 id="welcome-msg" style="color:#32bfb6">환영합니다!</h2>
            <select id="book-select" onchange="loadUnits()"><option value="">📚 교재 선택</option></select>
            <select id="unit-select" disabled><option value="">📂 유닛 선택</option></select>
            <button class="btn-primary" onclick="goToDashboard()">학습 대시보드로 이동 🚀</button>
        </div>

        <!-- 3. 대시보드 -->
        <div id="dashboard-section" class="hidden">
            <h3 id="dash-unit-title">Unit Name</h3>
            <p style="font-size:0.9rem; color:#888;">순서대로 미션을 클리어하세요!</p>
            
            <div class="menu-grid">
                <div class="menu-card" id="menu-1" onclick="tryStart(1, startFlashcard)">
                    <div class="status-icon"><i class="fa-solid fa-lock-open"></i></div>
                    <i class="fa-solid fa-layer-group"></i><h3>1. 단어 암기</h3>
                </div>
                <div class="menu-card locked" id="menu-2" onclick="tryStart(2, startMemoryGame)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-clone" style="color:#ff9800"></i><h3>2. 카드 뒤집기</h3>
                </div>
                <div class="menu-card locked" id="menu-3" onclick="tryStart(3, startContextQuiz)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-rotate"></i><h3>3. 반복 훈련</h3>
                </div>
                <div class="menu-card locked" id="menu-4" onclick="tryStart(4, startWordRain)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-cloud-rain" style="color:#2196f3"></i><h3>4. 단어 산성비</h3>
                </div>
                <div class="menu-card locked" id="menu-5" onclick="tryStart(5, startSpelling)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-keyboard"></i><h3>5. 스펠링</h3>
                </div>
                <div class="menu-card locked" id="menu-6" onclick="tryStart(6, startMonsterGame)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-dragon" style="color:#e91e63"></i><h3>6. 단어 몬스터</h3>
                </div>
                <div class="menu-card locked" id="menu-7" onclick="tryStart(7, startTest)">
                    <div class="status-icon"><i class="fa-solid fa-lock"></i></div>
                    <i class="fa-solid fa-file-signature"></i><h3>7. 실전 테스트</h3>
                </div>
            </div>
            
            <button class="btn-secondary" onclick="goBackToSelection()">교재 변경</button>
        </div>

        <!-- 4. 플래시카드 -->
        <div id="flashcard-section" class="hidden">
            <div class="card-container" onclick="flipCard()">
                <div class="card" id="flashcard">
                    <div class="card-face front"><span id="fc-en"></span></div>
                    <div class="card-face back">
                        <button class="audio-btn" onclick="event.stopPropagation(); playAudio()"><i class="fa-solid fa-volume-high"></i></button>
                        <div class="meaning-text" id="fc-ko"></div>
                        <div class="info-box" id="fc-ex"><span class="info-label">EXAMPLE</span><span id="fc-ex-text"></span></div>
                        <div class="info-box" id="fc-syn"><span class="info-label">SYNONYMS</span><span id="fc-syn-text"></span></div>
                        <div class="info-box" id="fc-ant"><span class="info-label">ANTONYMS</span><span id="fc-ant-text"></span></div>
                    </div>
                </div>
            </div>
            <div style="display:flex; justify-content:center; gap:10px;">
                <button class="btn-primary" style="width:120px" onclick="prevCard()">이전</button>
                <button class="btn-primary" style="width:120px" onclick="nextCard()">다음</button>
            </div>
            <p style="font-size: 0.8rem; color: #999; margin-top: 15px;">💡 Tip: <b>Space</b>로 뒤집고, <b>Enter</b>로 넘기세요!</p>
            <button class="btn-primary" style="background-color:#6c757d; margin-top:10px;" onclick="finishFlashcard()">암기 완료 (다음 단계로!)</button>
        </div>

        <!-- 5. 스펠링 -->
        <div id="spelling-section" class="hidden">
            <div class="score-board">점수: <span id="spell-score">0</span></div>
            <div class="question-box" id="spell-meaning"></div>
            <div class="hint-text" id="spell-hint"></div>
            <input type="text" id="spell-input" placeholder="정답 입력" autocomplete="off">
            <button class="btn-primary" onclick="checkSpelling()">확인</button>
            <p id="spell-feedback"></p>
            <button class="btn-secondary" onclick="stopStudyAndExit()">중단하기</button>
        </div>

        <!-- 5-1. 스펠링 결과 -->
        <div id="spelling-result-section" class="hidden">
            <h3>스펠링 학습 완료! 🎉</h3>
            <div style="font-size:1.5rem;">내 점수: <span id="spell-final-score" style="color:#32bfb6;">0</span>점</div>
            <div id="spell-submit-box" class="submit-confirm-box">
                <h4>📝 기록 제출 확인</h4>
                <span id="spell-submit-msg" class="submit-msg"></span>
                <button id="spell-submit-btn" class="btn-primary" onclick="submitCurrentRecord()">네! 제출할게요</button>
                <button class="btn-secondary" onclick="startRetrySpelling()">다시 연습할래요</button>
            </div>
            <div id="spell-wrong-list-area" class="hidden">
                <h4>❌ 틀린 단어 리스트</h4>
                <div id="spell-wrong-word-list" class="wrong-list-container"></div>
            </div>
            <button class="btn-secondary" onclick="backToDashboard()">대시보드로</button>
        </div>

        <!-- 6. 반복 훈련 -->
        <div id="quiz-section" class="hidden">
            <div class="score-board" id="quiz-progress">1 / 50</div>
            <div class="quiz-question-container">
                <div class="hint-text" id="quiz-type-badge" style="color:#32bfb6; font-weight:bold; margin-bottom:10px;"></div>
                <div class="question-box large-text" id="quiz-question"></div>
            </div>
            <div class="option-grid" id="quiz-options"></div>
            <button class="btn-secondary" onclick="stopStudyAndExit()">중단하기</button>
        </div>

        <!-- 6-1. 반복 훈련 결과 -->
        <div id="quiz-result-section" class="hidden">
            <h3>반복 훈련 완료! 🏆</h3>
            <div style="font-size:1.5rem;">내 점수: <span id="quiz-final-score" style="color:#32bfb6;">0</span>점</div>
            <div id="quiz-submit-box" class="submit-confirm-box">
                <h4>📝 기록 제출 확인</h4>
                <span id="quiz-submit-msg" class="submit-msg"></span>
                <button id="quiz-submit-btn" class="btn-primary" onclick="submitCurrentRecord()">네! 제출할게요</button>
                <button class="btn-secondary" onclick="startRetryQuiz()">다시 연습할래요</button>
            </div>
            <div id="quiz-wrong-list-area" class="hidden">
                <h4>❌ 틀린 문제 리스트</h4>
                <div id="quiz-wrong-word-list" class="wrong-list-container"></div>
            </div>
            <button class="btn-secondary" onclick="backToDashboard()">대시보드로</button>
        </div>

        <!-- 7. 선생님 관리 -->
        <div id="teacher-section" class="hidden">
            <h2 style="color:#32bfb6">👨‍🏫 선생님 모드</h2>
            <select id="teacher-book-select" onchange="renderTeacherTable()"></select>
            <table class="teacher-table">
                <thead><tr><th>학생명</th><th>유닛</th><th>진행률</th><th>점수</th><th>완료일</th></tr></thead>
                <tbody id="teacher-tbody"></tbody>
            </table>
            <button class="btn-secondary" onclick="logout()">로그아웃</button>
        </div>

        <!-- 5. 카드 짝맞추기 게임 -->
        <div id="memory-game-section" class="hidden">
            <h3 style="color:#ff9800">🃏 2. 카드 짝맞추기</h3>
            <div style="display:flex; justify-content:space-between; padding:0 20px;"><span>Time: <b id="mem-time">60</b>s</span> <span>Score: <b id="mem-score">0</b></span></div>
            <div class="memory-game-grid" id="memory-grid"></div>
            <button class="btn-secondary" onclick="stopStudyAndExit()">중단하기</button>
        </div>

        <!-- 6. 단어 산성비 게임 -->
        <div id="word-rain-section" class="hidden">
            <h3 style="color:#2196f3">🌧️ 4. 단어 산성비</h3>
            <div style="display:flex; justify-content:space-between; padding:0 20px;">
                <span>Life: <b id="rain-life">❤️❤️❤️</b></span> 
                <span>Goal: 4000 / Score: <b id="rain-score">0</b></span>
            </div>
            <div id="rain-canvas-container"></div>
            <div class="rain-input-area"><input type="text" id="rain-input" placeholder="단어 입력" autocomplete="off"></div>
            
            <!-- ★ [NEW] 조기 완료 버튼 (2000점 넘으면 보임) -->
            <button id="btn-rain-early-exit" class="btn-primary hidden" style="background-color:#2196f3; margin-top:10px;" onclick="finishGame('game_rain_clear', gameScore)">
                🎉 2000점 달성! 여기서 그만하고 완료하기
            </button>
            
            <button class="btn-secondary" onclick="stopStudyAndExit()">중단하기</button>
        </div>

        <!-- 7. 단어 몬스터 게임 -->
        <div id="monster-game-section" class="hidden">
            <h3 style="color:#e91e63">🐲 6. 단어 몬스터 격파!</h3>
            <div class="monster-container">
                <div class="monster-hp-bar"><div id="monster-hp" style="width:100%"></div></div>
                <div style="text-align:center; font-size:0.9rem; margin-bottom:5px;">Boss HP: <span id="monster-hp-text">100</span>%</div>
                <div id="monster-img">👾</div> 
                <div id="monster-damage" class="damage-effect hidden">-10</div>
                <div id="monster-msg" class="hit-msg hidden">으악!</div>
            </div>
            <div style="font-weight:bold; color:#ccc; margin: 10px 0;">VS</div>
            <div class="player-container">
                <div id="player-img">😊</div>
                <div style="text-align:center; font-size:0.9rem; margin-bottom:5px;">My HP: <span id="player-hp-text">100</span>%</div>
                <div class="player-hp-bar"><div id="player-hp" style="width:100%"></div></div>
                <div id="player-damage" class="damage-effect hidden">-20</div>
                <div id="player-msg" class="hit-msg hidden">아파!</div>
            </div>
            <div class="monster-quiz-area" style="margin-top:20px;">
                <div class="question-box" id="mon-question" style="min-height:50px; font-size:1.3rem;">Apple</div>
                <div class="option-grid" id="mon-options"></div>
            </div>
            <button class="btn-secondary" onclick="stopStudyAndExit()">도망가기</button>
        </div>

        <!-- 게임 결과 공통 화면 -->
        <div id="game-result-section" class="hidden">
            <h2 id="game-result-title">Game Over!</h2>
            <h1 id="game-final-score" style="font-size:3rem; color:#ff9800;">0</h1>
            <div class="ranking-list"><h4>🏆 명예의 전당</h4><div id="ranking-container">Loading...</div></div>
            <button class="btn-primary" id="btn-next-step" onclick="unlockNextStep()">다음 단계로! 🔓</button>
            <button class="btn-secondary" id="btn-replay-game">다시 하기</button>
        </div>

        <!-- 8. 실전 테스트 화면 -->
        <div id="test-section" class="hidden">
            <h3>실전 테스트 (Final Test)</h3>
            <div class="score-board">진행: <span id="test-progress">1 / 20</span></div>
            <div class="question-box large-text" id="test-question">사과</div>
            <p style="color:#888; font-size:0.9rem;">(힌트 없음! 정확한 스펠링을 입력하세요)</p>
            <input type="text" id="test-input" placeholder="정답 입력" style="font-size:1.2rem; text-align:center;" autocomplete="off">
            <button class="btn-primary" onclick="checkTestAnswer()">제출 (Enter)</button>
            <p id="test-feedback" style="height:20px; font-weight:bold;"></p>
            <button class="btn-secondary" onclick="stopStudyAndExit()">중단하기</button>
        </div>

        <!-- 8-1. 실전 테스트 결과 -->
        <div id="test-result-section" class="hidden">
            <h3>테스트 종료! 🏁</h3>
            <div style="font-size:1.5rem; margin: 10px 0;">
                내 점수: <span id="test-final-score" style="color:#32bfb6; font-weight:bold;">0</span>점
            </div>
            <div id="test-submit-box" class="submit-confirm-box">
                <h4>📝 기록 제출 확인</h4>
                <span id="test-submit-msg" class="submit-msg"></span>
                <button id="test-submit-btn" class="btn-primary" onclick="submitCurrentRecord()">네! 제출할게요 ✅</button>
                <button class="btn-secondary" onclick="startRetryTest()">틀린 문제 재시험 🔄</button>
            </div>
            <div id="test-wrong-list-area" class="hidden" style="margin-top:20px;">
                <h4 style="color:#dc3545; margin-bottom:10px;">❌ 틀린 단어 리스트</h4>
                <div id="test-wrong-word-list" class="wrong-list-container"></div>
            </div>
            <button class="btn-secondary" onclick="backToDashboard()" style="margin-top:30px;">대시보드로 (제출 안 함)</button>
        </div>
    </div>
    
    <!-- 인쇄 영역 -->
    <div id="print-area" class="print-area">
        <div class="print-header"><h1 id="print-title">Vocabulary Test</h1><p>Name: __________ Date: __________ Score: ______</p></div>
        <table class="print-table"><tbody id="print-tbody"></tbody></table>
    </div>

    <script src="script.js"></script>
</body>
</html>